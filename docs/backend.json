{
  "entities": {
    "Distributor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Distributor",
      "type": "object",
      "description": "Represents a distributor in the network marketing organization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Distributor entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the distributor."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the distributor."
        },
        "email": {
          "type": "string",
          "description": "Email address of the distributor.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the distributor."
        },
        "joinDate": {
          "type": "string",
          "description": "Date when the distributor joined the organization.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the distributor (e.g., funded, not-funded).",
          "enum": ["funded", "not-funded"]
        },
        "sponsorId": {
          "type": "string",
          "description": "Reference to the sponsoring Distributor. (Relationship: Distributor 1:N Distributor)"
        },
        "placementPosition": {
          "type": "string",
          "description": "The placement position of the distributor within the hierarchy."
        },
        "referralCode": {
            "type": "string",
            "description": "A unique code for enrolling new distributors."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "joinDate",
        "status",
        "sponsorId",
        "placementPosition",
        "referralCode"
      ]
    },
    "PerformanceMetric": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PerformanceMetric",
      "type": "object",
      "description": "Represents performance metrics for a distributor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PerformanceMetric entity."
        },
        "distributorId": {
          "type": "string",
          "description": "Reference to the Distributor. (Relationship: Distributor 1:N PerformanceMetric)"
        },
        "salesVolume": {
          "type": "number",
          "description": "Sales volume generated by the distributor."
        },
        "recruitmentCount": {
          "type": "number",
          "description": "Number of new distributors recruited."
        },
        "commissionEarnings": {
          "type": "number",
          "description": "Commission earnings for the distributor."
        },
        "metricDate": {
          "type": "string",
          "description": "The date the metric was calculated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "distributorId",
        "salesVolume",
        "recruitmentCount",
        "commissionEarnings",
        "metricDate"
      ]
    },
    "LibraryAsset": {
      "title": "Library Asset",
      "type": "object",
      "description": "Represents a file (document, image, video) in the shared asset library.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the asset." },
        "title": { "type": "string", "description": "The title of the asset." },
        "description": { "type": "string", "description": "A brief description of the asset." },
        "type": { "type": "string", "enum": ["document", "image", "video"], "description": "The type of the asset." },
        "fileUrl": { "type": "string", "format": "uri", "description": "URL to the asset file in storage." },
        "thumbnailUrl": { "type": "string", "format": "uri", "description": "Optional URL to a thumbnail image." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the asset was uploaded." }
      },
      "required": ["id", "title", "type", "fileUrl", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/distributors/{distributorId}",
        "definition": {
          "entityName": "Distributor",
          "schema": {
            "$ref": "#/backend/entities/Distributor"
          },
          "description": "Stores distributor profiles. Path-based ownership ensures that only the distributor can access their own profile. Includes denormalized data from parents in the hierarchy for reporting.",
          "params": [
            {
              "name": "distributorId",
              "description": "The unique identifier for the distributor.  This matches the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/distributors/{distributorId}/performanceMetrics/{metricId}",
        "definition": {
          "entityName": "PerformanceMetric",
          "schema": {
            "$ref": "#/backend/entities/PerformanceMetric"
          },
          "description": "Stores performance metrics for each distributor.  Accessible only by the distributor themselves or admins.",
          "params": [
            {
              "name": "distributorId",
              "description": "The unique identifier for the distributor."
            },
            {
              "name": "metricId",
              "description": "The unique identifier for the performance metric."
            }
          ]
        }
      },
      {
        "path": "/libraryAssets/{assetId}",
        "definition": {
            "entityName": "LibraryAsset",
            "schema": {
                "$ref": "#/backend/entities/LibraryAsset"
            },
            "description": "Stores shared library assets. Writable only by admins, readable by all signed-in users.",
            "params": [
                {
                    "name": "assetId",
                    "description": "The unique identifier for the library asset."
                }
            ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize network marketing genealogy and performance tracking while prioritizing security and scalability. It leverages path-based ownership for distributor data and denormalization to ensure authorization independence, critical for robust security rules and atomic operations. The structure segregates data based on access needs and uses consistent access modeling for clarity and predictability.\n\nDistributor profiles are stored under `/distributors/{distributorId}`.  Performance metrics associated with a distributor are stored in a subcollection `/distributors/{distributorId}/performanceMetrics/{metricId}`.\n\nAuthorization Independence is achieved through path-based ownership for private user data. Since each distributor's data lives under `/distributors/{distributorId}`, security rules can easily validate that `request.auth.uid == distributorId`.\n\nThe QAPs are addressed as follows:\n\n*   **Secure List Operations:** Data segregation based on access needs. The design ensures that listing distributors is separated from accessing sensitive performance data, enabling secure filtering.\n*   **Authorization Independence:** By avoiding hierarchical dependencies and storing the `ownerId` directly in the document, we eliminate the need for `get()` calls in security rules, enabling atomic operations."
  }
}
